<head>
  <link rel="stylesheet" type="text/css" href="static/common_layout.css">
</head>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/css/bootstrap-select.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/js/bootstrap-select.min.js"></script>
<link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<nav class="navbar navbar-default pull-right">
    <ul class="nav navbar-nav">
     <li><a><%=usrDetails.firstName %> <%= usrDetails.lastName%></a></li>
      <button type="button" onclick="document.location.href='/logout'"class="btn btn-default navbar-btn">Log Out</button>
    </ul>
  </nav>
  <div class="PlanHistoryPage">
  	<h1 class = "text-center">My Plan History</h1>
  	<br>
  	<br>
  	<div id ="fileDetails" style="visibility:hidden"><%= fileDetails%></div>
  	<div id ="selectionRow" class ="row text-center">
  	<div class="col-sm-10">	<select id ="SelectType" onchange="handleChangeType()" class="selectpicker input-xxlarge" data-style="btn-primary">
		  <option>Recently Uploaded</option>
		  <option>Date</option>
		  <option>Doctor</option>
		</select></div>
  	</div>
  	<br>
  	<br>
  	<div id ="listFiles" class ="text-center">
  	</div>
  </div>
  <script type="text/javascript">
  	var time1 =1483251408562;
  	var time2 = 1483251417634;
  	var time3 = 1483256303464;
  	var time4 = 1483256338867;
  	var details= [{filename: "MyPlan1", doctor: "doctor@doctor.com", timestamp: time1},{filename: "MyPlan2", doctor: "doctor@doctor.com", timestamp: time2},{filename: "MyPlan3", doctor: "doctor1@doctor.com", timestamp: time3},{filename: "MyPlan4", doctor: "doctor2@doctor.com", timestamp: time4}];
  	details.sort(function(a, b) {
    		return time2 - time1;
		});
	
	function handleChangeType()	{
		var listFilesDiv = document.getElementById("listFiles");
		listFilesDiv.innerText ="";
		var selectType = document.getElementById('SelectType').value;
		var selectionRow = document.getElementById("selectionRow");
		if(selectType =="Recently Uploaded"){
			if(document.getElementById("doctorSelect")){
				selectionRow.removeChild(document.getElementById("doctorSelect"));
			}
			for(var i=0;i<details.length;i++){
					var rowDiv = document.createElement("div");
					rowDiv.className ="row"; //<div class="col-sm-4">
					var colDiv1 = document.createElement("div");
					colDiv1.className ="col-sm-4"
					colDiv1.innerText = details[i].filename;
					rowDiv.appendChild(colDiv1);
					var colDiv2 = document.createElement("div");
					colDiv2.className ="col-sm-4"
					colDiv2.innerText = details[i].doctor;
					rowDiv.appendChild(colDiv2);
					var colDiv3 = document.createElement("div");
					colDiv3.className ="col-sm-4"
					var dt = new Date(details[i].timestamp);
					var fullDate = dt.getMonth() +1 +"/" + dt.getDate() + "/" +dt.getFullYear();
					colDiv3.innerText = fullDate;
					rowDiv.appendChild(colDiv3);
					var imageDiv = document.createElement("img");
					rowDiv.appendChild(imageDiv);
					listFilesDiv.appendChild(rowDiv)
			}
		}else if(selectType =="Doctor")	{
			var doctorSelectList = document.createElement("select"); //selectpicker
			// doctorSelectList.className ="selectpicker"
			doctorSelectList.id = "doctorSelect";
			
			$('#selectionRow').on('change', '#doctorSelect', function(){
				handleDoctorSelect();
			});
			
			selectionRow.appendChild(doctorSelectList);
			var docSet =new Set();
			console.log("details:",details);
			for(var j=0;j< details.length; j++){
				docSet.add(details[j].doctor);
			}
			for (let item of docSet) {
				 var option = document.createElement("option");
				  option.text = item;
				  doctorSelectList.appendChild(option);
			}
			
			handleDoctorSelect();
		}
	}
	handleChangeType();
		function handleDoctorSelect(){
			console.trace();
			var listFilesDiv = document.getElementById("listFiles");
			listFilesDiv.innerText ="";
			var doctorSelected = document.getElementById('doctorSelect').value;
			console.log("in handleDoctorSelect:doctorSelected:".doctorSelected);
			for(var i=0;i<details.length;i++){
				if(details[i].doctor ==doctorSelected){
						var rowDiv1 = document.createElement("div");
						rowDiv1.className ="row";
						var colDiv1 = document.createElement("div");
						colDiv1.className ="col-sm-4"
						colDiv1.innerText = details[i].filename;
						rowDiv1.appendChild(colDiv1);
						var colDiv2 = document.createElement("div");
						colDiv2.className ="col-sm-4"
						colDiv2.innerText = details[i].doctor;
						rowDiv1.appendChild(colDiv2);
						var colDiv3 = document.createElement("div");
						colDiv3.className ="col-sm-4"
						var dt = new Date(details[i].timestamp);
						var fullDate = dt.getMonth() +1 +"/" + dt.getDate() + "/" +dt.getFullYear();
						colDiv3.innerText = fullDate;
						rowDiv1.appendChild(colDiv3);
						var imageDiv = document.createElement("img");
						rowDiv1.appendChild(imageDiv);
						listFilesDiv.appendChild(rowDiv1);
				}
			}
	}
	
  </script>